XHTML to ODT XML transformation
-------------------------------

These stylesheets convert namespaced XHTML to [ODT][].


The HTML must be well-formed and valid, so I recommand running it through [Tidy][] before sending it to the stylesheets.

Those stylesheets do not build a whole ODT file, they only convert the XHTML to the equivalent OpenDocument XML. The result can then be inserted in a template ODT file. The HTML may be included in an ODT document, the ODT will be left untouched.

This is based on the work on [docbook2odt][], by Roman Fordinal. Many thanks to him.

[ODT]: http://en.wikipedia.org/wiki/OpenDocument
[Tidy]: http://tidy.sourceforge.net/
[docbook2odt]: http://open.comsultia.com/docbook2odf/


Caveats
-------

**Styles** : some default styles will be added to the document, but not on the first pass. After converting to ODT, you must run the `content.xml` and the `styles.xml` files (in the ODT file) through the `xsl/styles.xsl` stylesheet to add the styles. When the default styles are added, the stylesheet checks that the style is not already present, so customizations to the template ODT file will be preserved. It will however add styles that are not used in the text, but that's harmless.

**Images** : images are not added, you must manually go trough the draw:image elements in the converted ODT text and use the xlink:href attribute to download or copy the image. While you're at it, you should update the image dimensions if the were not provided in the img tag.


Command-line scripts
--------------------

Two command-line scripts to run the stylesheets are provided, one is Python-based, the other is PHP-based. They do import the styles and the images, so they can also be used as a code example for these two steps in other languages and actual export plugins.

Documentation for both scripts can be generated using the "`make doc`" command. This will require [sphinx][] for python and [phpDocumentor][] for PHP.

[sphinx]: http://sphinx.pocoo.org/
[phpDocumentor]: http://www.phpdoc.org/

### The python script

The python script is the preferred command-line script, because it currently is a little more complete than the PHP script. It depends on the following Python modules:

 * [uTidylib][]
 * [lxml][]
 * [PIL][]

To get information on the script's options, run it with `--help`:

    ./xhtml2odt.py --help

The script can be installed on the system with the `make install` command.

[uTidylib]: http://pypi.python.org/pypi/uTidylib
[lxml]: http://pypi.python.org/pypi/lxml
[PIL]: http://pypi.python.org/pypi/PIL

### The PHP script

The PHP script can be used as an example to create an ODT export plugin for a PHP-based application. It contains comments on what you should do differently in a web-based application. If you want a real PHP-based export plugin, you can look at the code of the [Dotclear ODT export plugin][].

The PHP script requires the [zip][] module, and will work better with the [tidy][] extension.

To get information on the script's options, run it with `--help`:

    ./xhtml2odt.php --help

[Dotclear ODT export plugin]: http://lab.dotclear.org/wiki/plugin/odt
[zip]: http://php.net/manual/en/zip.installation.php
[tidy]: http://php.net/manual/en/book.tidy.php


Tests
-----

The unit tests are python-based, you need to install the [nose][] python module availble from PyPI (or your distribution).

Then, just run "`nosetests tests`".

[nose]: http://pypi.python.org/pypi/nose/


References
----------

 * [ODT export for Dotclear](http://lab.dotclear.org/wiki/plugin/odt)
 * [ODT export for Trac](http://trac-hacks.org/wiki/OdtExportPlugin)
 * [ODT export for Dokuwiki](http://www.dokuwiki.org/plugin:odt) (not using this project, but similar and by the same author)


License
-------

Copyright (C) 2009-2010 [Aurelien Bompard][].

License is GPL v2 or later.

Based on the work on [docbook2odt][], by Roman Fordinal.

[Aurelien Bompard]: http://aurelien.bompard.org/
[docbook2odt]: http://open.comsultia.com/docbook2odf/

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
